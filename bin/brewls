#!/usr/bin/env python3
from rich import print
import argparse
import subprocess

def search(package):
    p = subprocess.Popen(['brew', 'search', '--desc', '""'], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    for line in iter(p.stdout.readline, b''):
        response = line.decode().strip()
        # response = p.stdout.readline().strip()
        if package.lower() in response.lower():
            print('[cyan]{}[/cyan][red]:[/red][green]{}[/green]'.format(response.split(':')[0], response.split(':')[1]))
        elif '==> Formulae' in response or '==> Casks' in response:
            print(response)


if __name__ == '__main__':
    ap = argparse.ArgumentParser()
    ap.add_argument('query', nargs='?', default=':', help='(optional) search term for brew packages')
    args = ap.parse_args()

    search(args.query)
